generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
}

model Booking_Halls {
  hall_id       Int      @id @default(autoincrement())
  hall_name     String   @db.VarChar(100)
  hall_location String   @db.VarChar(100)
  hall_capacity Int
  Events        Events[]
  Seats         Seats[]
}

model Bookings {
  booking_id    Int         @id @default(autoincrement())
  user_id       Int
  event_id      Int
  payment_id    Int
  event_seat_id Int
  Users         Users       @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "Bookings_ibfk_1")
  Events        Events      @relation(fields: [event_id], references: [event_id], onDelete: NoAction, onUpdate: NoAction, map: "Bookings_ibfk_2")
  Payments      Payments    @relation(fields: [payment_id], references: [payment_id], onDelete: NoAction, onUpdate: NoAction, map: "Bookings_ibfk_4")
  Event_Seats   Event_Seats @relation(fields: [event_seat_id], references: [event_seat_id], onDelete: NoAction, onUpdate: NoAction, map: "Bookings_ibfk_5")

  @@index([event_id], map: "event_id")
  @@index([event_seat_id], map: "event_seat_id")
  @@index([payment_id], map: "payment_id")
  @@index([user_id], map: "user_id")
}

model Event_Seats {
  event_seat_id  Int                @id @default(autoincrement())
  event_id       Int
  seat_id        Int
  status         Event_Seats_status @default(available)
  locked_user_id Int?
  lock_expire    DateTime?          @db.DateTime(0)
  Bookings       Bookings[]
  Events         Events             @relation(fields: [event_id], references: [event_id], onDelete: NoAction, onUpdate: NoAction, map: "Event_Seats_ibfk_1")
  Seats          Seats              @relation(fields: [seat_id], references: [seat_id], onDelete: NoAction, onUpdate: NoAction, map: "Event_Seats_ibfk_2")
  Users          Users?             @relation(fields: [locked_user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "Event_Seats_ibfk_3")

  @@index([event_id], map: "event_id")
  @@index([locked_user_id], map: "locked_user_id")
  @@index([seat_id], map: "seat_id")
}

model Events {
  event_id      Int           @id @default(autoincrement())
  event_name    String        @db.VarChar(255)
  event_date    DateTime      @db.Date
  hall_id       Int
  created_at    DateTime?     @default(now()) @db.Timestamp(0)
  Bookings      Bookings[]
  Event_Seats   Event_Seats[]
  Booking_Halls Booking_Halls @relation(fields: [hall_id], references: [hall_id], onDelete: NoAction, onUpdate: NoAction, map: "Events_ibfk_1")

  @@index([hall_id], map: "hall_id")
}

model Payments {
  payment_id     Int                      @id @default(autoincrement())
  payment_amount Decimal                  @db.Decimal(10, 2)
  payment_time   DateTime?                @db.DateTime(0)
  user_id        Int
  transaction_id String                   @db.VarChar(255)
  payment_status Payments_payment_status? @default(pending)
  Bookings       Bookings[]
  Users          Users                    @relation(fields: [user_id], references: [user_id], onDelete: NoAction, onUpdate: NoAction, map: "Payments_ibfk_1")

  @@index([user_id], map: "user_id")
}

model Seats {
  seat_id       Int           @id @default(autoincrement())
  seat_number   Int
  seat_row      Int?
  hall_id       Int
  Event_Seats   Event_Seats[]
  Booking_Halls Booking_Halls @relation(fields: [hall_id], references: [hall_id], onDelete: NoAction, onUpdate: NoAction, map: "Seats_ibfk_1")

  @@unique([seat_row, seat_number, hall_id], map: "seat_row")
  @@index([hall_id], map: "hall_id")
}

model Users {
  user_id       Int           @id @default(autoincrement())
  user_name     String        @db.VarChar(100)
  user_dob      DateTime?     @db.Date
  user_email    String        @unique(map: "user_email") @db.VarChar(100)
  user_mob      String        @db.VarChar(15)
  user_password String        @db.VarChar(255)
  created_at    DateTime?     @default(now()) @db.Timestamp(0)
  updated_at    DateTime?     @default(now()) @db.Timestamp(0)
  Bookings      Bookings[]
  Event_Seats   Event_Seats[]
  Payments      Payments[]
}

enum Event_Seats_status {
  available
  locked
  booked
  expired
}

enum Payments_payment_status {
  pending
  success
  failed
  refunded
}
